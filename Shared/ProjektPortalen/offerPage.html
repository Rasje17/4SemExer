<!DOCTYPE html>
<html>

<head>
    <title>ProjektPortalen</title>
    <link rel="stylesheet" href="styles.css">
    <meta charset="utf-8" />
</head>

<header>
    <a href="index.html">Forside</a>
    <a id="loginRef"></a>
</header>

<body>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        window.onload = () => {
            let this_url = window.location.href;

            if (urlParams.has('loginVal') && urlParams.get('loginVal') != 0 && urlParams.get('loginVal') != null) {
                document.getElementById('loginRef').innerHTML = "Log Ud";
                document.getElementById('loginRef').href = "index.html";
            }
            else {
                document.getElementById('loginRef').innerHTML = "Login";
                document.getElementById('loginRef').href = ("login.html?src=" + this_url);
            }

            console.log(urlParams.has('offerId'));
            console.log(urlParams.get('offerId'));

            let offerId = (urlParams.get('offerId'));
            let userId = (urlParams.get('userId'));

            console.log(urlParams.get('userId'));

            function offervalue(data) {
                let receivedOffer = JSON.parse(data);
                console.log(receivedOffer);
                document.getElementById("offerTitle").innerHTML = receivedOffer.title;
                document.getElementById('contactInfo').innerHTML = receivedOffer.contactInfo;
                document.getElementById('longDesc').innerHTML = receivedOffer.longDesc;
            }

            fetch('http://localhost:8888/offer?id=' + offerId)
                .then(response => response.json())
                .then(json => offervalue(json));


            let applyBtn = document.getElementById("applyButton");
            applyBtn.addEventListener("click", () => {
                console.log('inden if...')
                if (urlParams.get('userId') != null) {
                    fetch(('http://localhost:8888/offer?applicant=' + userId + '&offerId=' + offerId),
                        { method: 'PUT' })
                        .then(resp => console.log(resp.status));
                } else {
                    //refer to login with url as parameter
                }
            })
        }

    </script>

    <h2>
        <p type='text' id='offerTitle'>
    </h2>

    <section class="offerPage">
        <p type='text' id='contactInfo'>
    </section>
    <section class="offerPage">
        <p type='text' id='longDesc'>
    </section>

    <button type="button" id="applyButton">Ans√∏g</button>

</body>

</html>